// Pac-Man DJ Battle V7 – Labyrinthe original propre + fond La Boum visible au centre
let pacmanImg, discoImg, backgroundImg;
let ghostImgs = [], ghostScaredImg;
let pacman, pacmanLives = 3;
let ghosts = [], ghostSpawnTimers = [];
let gridSize = 20;
let cols = 28;
let rows = 31;
let grid = [];
let direction, nextDirection;
let score = 0;
let highScore = 0;
let gameOver = false;
let ghostScared = false;
let ghostScaredTimer = 0;
let touchStartX, touchStartY;

// 1 = mur, 0 = pastille, 2 = vide (fond visible), 9 = enclos fantômes
const levelMap = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,1],
  [1,0,1,2,2,1,0,1,2,2,1,0,1,1,1,0,1,2,2,1,0,1,2,2,1,0,1,1],
  [1,0,1,2,2,1,0,1,2,2,1,0,0,0,0,0,1,2,2,1,0,1,2,2,1,0,1,1],
  [1,0,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,1,1,1,0,1,1,1,1,0,1,9,1,0,1,1,1,1,0,1,1,1,1,0,1,1],
  [1,0,1,2,2,1,0,1,2,2,1,0,1,9,1,0,1,2,2,1,0,1,2,2,1,0,1,1],
  [1,0,1,2,2,1,0,1,2,2,1,0,1,9,1,0,1,2,2,1,0,1,2,2,1,0,1,1],
  [1,0,1,1,1,1,0,1,1,1,1,0,1,9,1,0,1,1,1,1,0,1,1,1,1,0,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,1,1,1,0,1,1,1,1,0,1,9,1,0,1,1,1,1,0,1,1,1,1,0,1,1],
  [1,0,1,2,2,1,0,1,2,2,1,0,1,1,1,0,1,2,2,1,0,1,2,2,1,0,1,1],
  [1,0,1,2,2,1,0,1,2,2,1,0,0,0,0,0,1,2,2,1,0,1,2,2,1,0,1,1],
  [1,0,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1],
  [1,0,0,0,0,1,0,1,2,2,1,0,1,2,1,0,1,2,2,1,0,1,0,0,0,0,0,1],
  [1,1,1,1,0,1,0,1,2,2,1,0,1,2,1,0,1,2,2,1,0,1,0,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
];

function initGrid() {
  grid = [];
  for (let y = 0; y < rows; y++) {
    let row = [];
    for (let x = 0; x < cols; x++) {
      const cell = levelMap[y][x];
      row.push({
        wall: cell === 1 || cell === 9,
        disco: cell === 0
      });
    }
    grid.push(row);
  }
}
